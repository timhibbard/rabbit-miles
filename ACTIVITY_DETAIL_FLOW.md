# Activity Detail Page User Flow

## User Journey

```
1. Dashboard Page
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ RabbitMiles Dashboard                           â”‚
   â”‚                                                 â”‚
   â”‚ Stats Cards: Total | Week | Month | Year       â”‚
   â”‚                                                 â”‚
   â”‚ Recent Activities:                              â”‚
   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
   â”‚ â”‚ Morning Run          [Ride badge]     â”‚â†â”€â”€â”€ Clickable!
   â”‚ â”‚ Today, 8:00 AM                        â”‚       â”‚
   â”‚ â”‚ Distance: 5.2 mi (3.1 mi on trail)   â”‚       â”‚
   â”‚ â”‚ Duration: 42:15    Pace: 8:07/mi     â”‚       â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
   â”‚ â”‚ Evening Ride         [Ride badge]     â”‚       â”‚
   â”‚ â”‚ Yesterday, 6:30 PM                    â”‚       â”‚
   â”‚ â”‚ Distance: 12.4 mi (8.2 mi on trail)  â”‚       â”‚
   â”‚ â”‚ Duration: 1:15:30  Pace: 6:05/mi     â”‚       â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â”‚ Click on activity
                      â–¼
2. Activity Detail Page
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ â† Back to Dashboard                             â”‚
   â”‚                                                 â”‚
   â”‚ Morning Run                    [Run] [View on   â”‚
   â”‚ Monday, February 4, 2026, 8:00 AM     Strava]  â”‚
   â”‚                                                 â”‚
   â”‚ Stats Grid:                                     â”‚
   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
   â”‚ â”‚Distance  â”‚Moving    â”‚Pace      â”‚Elevation â”‚ â”‚
   â”‚ â”‚5.2 mi    â”‚Time      â”‚8:07/mi   â”‚125 ft    â”‚ â”‚
   â”‚ â”‚3.1 mi on â”‚42:15     â”‚          â”‚          â”‚ â”‚
   â”‚ â”‚trail     â”‚25:30 on  â”‚          â”‚          â”‚ â”‚
   â”‚ â”‚          â”‚trail     â”‚          â”‚          â”‚ â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
   â”‚                                                 â”‚
   â”‚ Route Map                                       â”‚
   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
   â”‚ â”‚                                             â”‚â”‚
   â”‚ â”‚     â•±â•²      â”Œâ”€â”€â”€â”€â”€â”                        â”‚â”‚
   â”‚ â”‚    â•±  â•²     â”‚     â”‚    ğŸŸ¢ Green line       â”‚â”‚
   â”‚ â”‚   ğŸŸ¢   ğŸŸ¢   â”‚ Map â”‚    (on trail)          â”‚â”‚
   â”‚ â”‚  ğŸŸ¢     ğŸŸ¢  â””â”€â”€â”€â”€â”€â”˜                        â”‚â”‚
   â”‚ â”‚ ğŸŸ¢       ğŸ”µ          ğŸ”µ Blue line          â”‚â”‚
   â”‚ â”‚ğŸŸ¢         ğŸ”µ         (off trail)           â”‚â”‚
   â”‚ â”‚           ğŸ”µ                                â”‚â”‚
   â”‚ â”‚          ğŸ”µ                                 â”‚â”‚
   â”‚ â”‚                                             â”‚â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
   â”‚ ğŸŸ¢ On trail  ğŸ”µ Off trail                      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Features

### Interactive Map
- **Leaflet-based** interactive map
- **Pan and zoom** to explore the route
- **Color-coded segments**:
  - Green (#10b981): Portions on the trail
  - Blue (#3b82f6): Portions off the trail
- **Automatic bounds fitting** to show entire route
- **OpenStreetMap tiles** for base layer

### Trail Segment Calculation
The frontend calculates which segments are on/off trail by:
1. Loading trail GeoJSON data (main trail + spurs)
2. For each point in the activity route:
   - Calculate distance to nearest trail segment
   - Mark as "on trail" if within 25 meters
3. Group consecutive on/off trail points into segments
4. Render each segment with appropriate color

### Activity Information
- **Complete statistics**: distance, moving time, pace, elevation gain
- **Trail metrics**: Shows distance and time on trail (when available)
- **Activity type badge**: Visual indicator (Run, Ride, Walk)
- **Strava link**: Direct link to view the original activity on Strava
- **Date/time display**: Full timestamp of activity

### Error Handling
- Loading states while fetching data
- Graceful handling of missing polyline data
- Fallback display for activities without trail matching
- Proper authentication flow (redirects to /connect if not logged in)

## Technical Implementation

### Data Flow
```
User clicks activity
       â†“
Frontend calls: GET /activities/:id
       â†“
Backend Lambda: get_activity_detail
       â†“
Validates session cookie
       â†“
Checks activity ownership
       â†“
Returns activity + polyline
       â†“
Frontend decodes polyline
       â†“
Loads trail GeoJSON
       â†“
Calculates trail segments
       â†“
Renders map with colored polylines
```

### Performance Considerations
- Trail GeoJSON files (~116KB total) loaded once per activity view
- Polyline decoding is efficient (O(n) where n = polyline length)
- Trail matching calculation optimized with spatial checks
- Map library (Leaflet) handles rendering performance
